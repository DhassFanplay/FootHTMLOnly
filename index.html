<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Foot Tracking Full Model with Correct WASM URL</title>
  <style>body { margin: 0; overflow: hidden; }</style>
  <script type="module">
    import {
      FilesetResolver,
      PoseLandmarker,
      DrawingUtils
    } from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3";

    let video, canvas, ctx, poseLandmarker;

    async function init() {
      video = document.createElement("video");
      video.autoplay = true;
      video.playsInline = true;
      document.body.appendChild(video);

      canvas = document.createElement("canvas");
      document.body.appendChild(canvas);
      ctx = canvas.getContext("2d");

      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;

      await new Promise((r) => (video.onloadedmetadata = r));

      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;

      // Notice the trailing slash here:
      const vision = await FilesetResolver.forVisionTasks(
        "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3/wasm/"
      );

      poseLandmarker = await PoseLandmarker.createFromOptions(vision, {
        baseOptions: {
          modelAssetPath:
            "https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_full/float16/1/pose_landmarker_full.task"
        },
        runningMode: "VIDEO",
        numPoses: 1
      });

      requestAnimationFrame(trackFoot);
    }

    async function trackFoot() {
      if (!poseLandmarker || video.readyState !== 4) {
        requestAnimationFrame(trackFoot);
        return;
      }

      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      const results = await poseLandmarker.detectForVideo(video, performance.now());
      if (results.landmarks.length > 0) {
        const draw = new DrawingUtils(ctx);
        const landmarks = results.landmarks[0];
        draw.drawLandmarks(landmarks, { color: "red", radius: 3 });

        const LEFT_FOOT_INDEX = 31;
        const RIGHT_FOOT_INDEX = 32;

        const leftFoot = landmarks[LEFT_FOOT_INDEX];
        const rightFoot = landmarks[RIGHT_FOOT_INDEX];

        if (leftFoot && rightFoot) {
          console.log("Left Foot:", leftFoot);
          console.log("Right Foot:", rightFoot);
        }
      }

      requestAnimationFrame(trackFoot);
    }

    init();
  </script>
</head>
<body></body>
</html>
